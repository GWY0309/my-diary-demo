# 用户需求文档(PRD)

## 1. 文档概述

### 1.1 文档目的
本文档详细描述了私人日记App - My Diary的用户需求，包括功能需求、非功能需求、用户故事、验收标准等内容，为产品设计、开发和测试提供明确的指导。

### 1.2 文档范围
本文档涵盖了My Diary App的核心功能和非功能需求，包括用户认证、隐私保护、日记管理、内容编辑、数据同步、搜索统计、主题切换等模块。

### 1.3 术语定义
| 术语 | 定义 |
|------|------|
| PRD | Product Requirements Document，产品需求文档 |
| Flutter | Google开发的跨平台移动应用开发框架 |
| Firebase | Google提供的移动和Web应用开发平台 |
| SQLite | 轻量级的关系型数据库管理系统 |
| AES-256 | 高级加密标准，256位密钥长度 |
| HTTPS | 超文本传输安全协议 |
| MVP | Minimum Viable Product，最小可行产品 |

### 1.4 参考文档
- 项目可行性报告
- 项目范围说明书
- 工作分解结构和甘特图

## 2. 用户分析

### 2.1 用户画像

#### 2.1.1 主要用户
| 用户类型 | 特征 | 需求 |
|----------|------|------|
| 学生 | 18-25岁，喜欢记录生活点滴、学习心得 | 简单易用的界面，支持图片添加，标签分类 |
| 白领 | 25-35岁，注重隐私，需要记录工作和生活 | 隐私保护，数据备份，搜索功能 |
| 文艺青年 | 20-30岁，喜欢写作，追求个性化 | 丰富的编辑功能，自定义主题，统计分析 |

#### 2.1.2 用户痛点
1. 现有日记应用广告太多，影响体验
2. 隐私保护不够，担心数据泄露
3. 界面复杂，操作不直观
4. 不支持跨设备同步，数据容易丢失
5. 编辑功能有限，无法满足个性化需求

### 2.2 用户故事

| 用户故事ID | 用户角色 | 需求描述 | 验收标准 | 优先级 |
|------------|----------|----------|----------|--------|
| US-001 | 新用户 | 我希望能够注册一个账号，以便使用日记应用 | 1. 提供邮箱注册功能<br>2. 验证邮箱格式正确性<br>3. 设置密码强度要求<br>4. 注册成功后自动登录 | 高 |
| US-002 | 现有用户 | 我希望能够安全登录应用，以便访问我的日记 | 1. 提供邮箱/密码登录<br>2. 支持记住密码功能<br>3. 提供忘记密码功能<br>4. 登录失败显示错误信息 | 高 |
| US-003 | 所有用户 | 我希望应用有隐私保护功能，以确保我的日记安全 | 1. 支持设置应用锁密码<br>2. 支持指纹/面容识别解锁<br>3. 数据本地加密存储<br>4. 退出应用后自动锁定 | 高 |
| US-004 | 所有用户 | 我希望能够创建新的日记，以便记录我的生活 | 1. 提供日记标题和内容输入<br>2. 自动记录创建时间<br>3. 支持添加图片<br>4. 支持添加标签<br>5. 保存草稿功能 | 高 |
| US-005 | 所有用户 | 我希望能够编辑已有的日记，以便修改或补充内容 | 1. 支持修改日记标题和内容<br>2. 支持添加/删除图片<br>3. 支持添加/删除标签<br>4. 自动记录修改时间<br>5. 保存草稿功能 | 高 |
| US-006 | 所有用户 | 我希望能够删除不需要的日记，以便保持日记列表整洁 | 1. 支持单条日记删除<br>2. 支持多条日记批量删除<br>3. 删除前显示确认提示<br>4. 删除后更新日记列表 | 高 |
| US-007 | 所有用户 | 我希望能够查看已有的日记，以便回顾过去的记录 | 1. 日记列表按时间倒序排列<br>2. 支持按日期快速定位<br>3. 日记详情完整显示<br>4. 支持左右滑动切换日记 | 高 |
| US-008 | 所有用户 | 我希望能够添加图片到日记中，以便更生动地记录 | 1. 支持从相册选择图片<br>2. 支持拍摄新图片<br>3. 支持图片预览和删除<br>4. 限制单篇日记图片数量 | 高 |
| US-009 | 所有用户 | 我希望能够使用标签管理日记，以便分类和查找 | 1. 支持创建自定义标签<br>2. 支持为日记添加多个标签<br>3. 支持标签编辑和删除<br>4. 显示标签使用统计 | 中 |
| US-010 | 所有用户 | 我希望能够搜索日记，以便快速找到需要的内容 | 1. 支持按关键词搜索<br>2. 支持按标签搜索<br>3. 支持按日期范围搜索<br>4. 搜索结果实时显示 | 中 |
| US-011 | 所有用户 | 我希望能够备份我的日记数据，以便防止数据丢失 | 1. 支持自动云同步<br>2. 支持手动备份<br>3. 显示同步状态<br>4. 支持数据恢复 | 高 |
| US-012 | 所有用户 | 我希望能够查看日记统计信息，以便了解我的写作习惯 | 1. 显示日记总数量<br>2. 显示每月写作频率<br>3. 显示标签使用频率<br>4. 提供可视化图表 | 中 |
| US-013 | 所有用户 | 我希望能够切换应用主题，以便适应不同的使用场景 | 1. 支持日间/夜间模式<br>2. 支持自定义主题颜色<br>3. 主题切换流畅无卡顿<br>4. 记住用户主题偏好 | 中 |

## 3. 功能需求

### 3.1 核心功能

#### 3.1.1 用户认证模块
| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| FR-001 | 注册功能 | 用户通过邮箱和密码注册账号，系统发送验证邮件 | 高 |
| FR-002 | 登录功能 | 用户通过邮箱和密码登录应用，支持记住密码 | 高 |
| FR-003 | 忘记密码 | 用户通过邮箱重置密码，系统发送重置链接 | 高 |
| FR-004 | 退出登录 | 用户退出当前账号，清除本地登录状态 | 高 |

#### 3.1.2 隐私保护模块
| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| FR-005 | 应用锁设置 | 用户设置应用锁密码，支持数字密码 | 高 |
| FR-006 | 生物识别解锁 | 支持指纹/面容识别解锁应用 | 高 |
| FR-007 | 自动锁定 | 应用退到后台一定时间后自动锁定 | 高 |
| FR-008 | 数据加密 | 本地日记数据使用AES-256加密存储 | 高 |

#### 3.1.3 日记管理模块
| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| FR-009 | 创建日记 | 用户创建新日记，包含标题、内容、日期等信息 | 高 |
| FR-010 | 编辑日记 | 用户修改已有的日记内容和信息 | 高 |
| FR-011 | 删除日记 | 用户删除不需要的日记，支持单删和批量删除 | 高 |
| FR-012 | 查看日记 | 用户查看日记详情，支持滑动切换 | 高 |
| FR-013 | 日记列表 | 按时间倒序显示所有日记，支持下拉刷新 | 高 |

#### 3.1.4 内容编辑模块
| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| FR-014 | 文字编辑 | 支持文字输入、修改、格式化（粗体、斜体等） | 高 |
| FR-015 | 图片添加 | 支持从相册选择或拍摄图片添加到日记 | 高 |
| FR-016 | 图片管理 | 支持图片预览、删除、排序 | 高 |
| FR-017 | 标签管理 | 支持创建、编辑、删除标签，为日记添加标签 | 中 |
| FR-018 | 日期选择 | 支持修改日记日期 | 中 |

#### 3.1.5 数据同步模块
| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| FR-019 | 自动同步 | 日记数据自动同步到云端，保持多设备一致 | 高 |
| FR-020 | 手动同步 | 用户手动触发数据同步，查看同步状态 | 高 |
| FR-021 | 数据恢复 | 从云端恢复日记数据到本地 | 高 |
| FR-022 | 存储管理 | 显示云端存储使用情况，提供清理功能 | 中 |

#### 3.1.6 搜索和统计模块
| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| FR-023 | 关键词搜索 | 按日记标题和内容搜索 | 中 |
| FR-024 | 标签搜索 | 按标签搜索相关日记 | 中 |
| FR-025 | 日期搜索 | 按日期范围搜索日记 | 中 |
| FR-026 | 统计分析 | 提供日记数量、写作频率、标签使用等统计 | 中 |

#### 3.1.7 主题切换模块
| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| FR-027 | 日间/夜间模式 | 支持自动和手动切换日间/夜间模式 | 中 |
| FR-028 | 自定义主题 | 支持用户自定义主题颜色 | 中 |

### 3.2 次要功能

#### 3.2.1 设置模块
| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| FR-029 | 账号设置 | 修改邮箱、密码等账号信息 | 中 |
| FR-030 | 通知设置 | 开启/关闭应用通知 | 低 |
| FR-031 | 关于应用 | 显示应用版本、隐私政策等信息 | 低 |

#### 3.2.2 帮助模块
| 功能ID | 功能名称 | 功能描述 | 优先级 |
|--------|----------|----------|--------|
| FR-032 | 帮助中心 | 提供应用使用教程和常见问题解答 | 低 |
| FR-033 | 反馈功能 | 用户提交意见和建议 | 低 |

## 4. 非功能需求

### 4.1 性能需求
| 需求ID | 需求描述 | 验收标准 | 优先级 |
|--------|----------|----------|--------|
| NF-001 | 应用启动时间 | 应用启动时间不超过3秒 | 高 |
| NF-002 | 页面响应时间 | 页面切换和操作响应时间不超过0.5秒 | 高 |
| NF-003 | 数据同步时间 | 日记数据同步到云端的时间不超过1秒 | 高 |
| NF-004 | 内存占用 | 应用内存占用不超过200MB | 中 |
| NF-005 | 电池消耗 | 正常使用情况下，电池消耗不超过5%/小时 | 中 |

### 4.2 安全需求
| 需求ID | 需求描述 | 验收标准 | 优先级 |
|--------|----------|----------|--------|
| NF-006 | 数据传输加密 | 所有网络请求使用HTTPS加密 | 高 |
| NF-007 | 本地数据加密 | 本地日记数据使用AES-256加密存储 | 高 |
| NF-008 | 密码安全 | 密码存储使用加盐哈希算法 | 高 |
| NF-009 | 隐私政策 | 符合GDPR和CCPA隐私保护法规 | 高 |
| NF-010 | 访问控制 | 敏感操作需要重新验证身份 | 高 |

### 4.3 兼容性需求
| 需求ID | 需求描述 | 验收标准 | 优先级 |
|--------|----------|----------|--------|
| NF-011 | Android版本兼容 | 支持Android 6.0+（API级别23+） | 高 |
| NF-012 | iOS版本兼容 | 支持iOS 12.0+ | 高 |
| NF-013 | 屏幕适配 | 适配所有主流手机屏幕尺寸（3.5英寸-7英寸） | 高 |
| NF-014 | 设备方向 | 支持横屏和竖屏切换 | 中 |

### 4.4 可用性需求
| 需求ID | 需求描述 | 验收标准 | 优先级 |
|--------|----------|----------|--------|
| NF-015 | 界面设计 | 符合Material Design 3规范，简洁直观 | 高 |
| NF-016 | 用户引导 | 首次使用提供简单的功能引导 | 中 |
| NF-017 | 错误提示 | 操作失败时显示清晰的错误提示信息 | 高 |
| NF-018 | 帮助文档 | 提供详细的用户帮助文档 | 中 |

### 4.5 可维护性需求
| 需求ID | 需求描述 | 验收标准 | 优先级 |
|--------|----------|----------|--------|
| NF-019 | 代码规范 | 遵循Flutter代码规范，注释完整 | 中 |
| NF-020 | 日志记录 | 记录关键操作和错误日志 | 中 |
| NF-021 | 模块化设计 | 代码结构清晰，模块化程度高 | 中 |

## 5. 数据需求

### 5.1 数据实体

#### 5.1.1 用户(User)
| 字段名 | 类型 | 描述 |
|--------|------|------|
| userId | String | 用户唯一标识 |
| email | String | 用户邮箱 |
| passwordHash | String | 密码哈希值 |
| salt | String | 密码盐值 |
| createdAt | Timestamp | 创建时间 |
| updatedAt | Timestamp | 更新时间 |
| themePreference | String | 主题偏好 |
| appLockEnabled | Boolean | 是否启用应用锁 |
| appLockPassword | String | 应用锁密码哈希 |
| biometricEnabled | Boolean | 是否启用生物识别 |

#### 5.1.2 日记(Diary)
| 字段名 | 类型 | 描述 |
|--------|------|------|
| diaryId | String | 日记唯一标识 |
| userId | String | 所属用户ID |
| title | String | 日记标题 |
| content | String | 日记内容 |
| date | Timestamp | 日记日期 |
| createdAt | Timestamp | 创建时间 |
| updatedAt | Timestamp | 更新时间 |
| tags | Array<String> | 标签列表 |
| imageUrls | Array<String> | 图片URL列表 |

#### 5.1.3 标签(Tag)
| 字段名 | 类型 | 描述 |
|--------|------|------|
| tagId | String | 标签唯一标识 |
| userId | String | 所属用户ID |
| name | String | 标签名称 |
| color | String | 标签颜色 |
| createdAt | Timestamp | 创建时间 |

### 5.2 数据存储
| 数据类型 | 存储方式 | 加密方式 | 同步方式 |
|----------|----------|----------|----------|
| 用户信息 | Firebase Firestore | HTTPS加密传输 | 实时同步 |
| 日记内容 | Firebase Firestore | HTTPS加密传输 | 实时同步 |
| 日记图片 | Firebase Storage | HTTPS加密传输 | 实时同步 |
| 本地缓存 | SQLite | AES-256加密 | 自动同步 |

## 6. 验收标准

### 6.1 功能验收
| 功能模块 | 验收标准 |
|----------|----------|
| 用户认证 | 1. 注册流程顺畅，验证邮件发送成功<br>2. 登录功能正常，支持记住密码<br>3. 忘记密码流程有效，重置邮件发送成功<br>4. 退出登录后清除用户数据 |
| 隐私保护 | 1. 应用锁设置成功，退出应用后自动锁定<br>2. 生物识别解锁功能正常<br>3. 本地数据加密有效，无法直接读取 |
| 日记管理 | 1. 日记创建、编辑、删除功能正常<br>2. 日记列表显示正确，按时间倒序排列<br>3. 日记详情完整显示，支持滑动切换 |
| 内容编辑 | 1. 文字编辑功能正常，支持基本格式化<br>2. 图片添加、删除、预览功能正常<br>3. 标签管理功能正常，支持添加多个标签 |
| 数据同步 | 1. 数据自动同步到云端，多设备保持一致<br>2. 手动同步功能有效，显示同步状态<br>3. 数据恢复功能正常，能够恢复历史数据 |
| 搜索和统计 | 1. 关键词搜索结果准确<br>2. 标签搜索和日期搜索功能正常<br>3. 统计信息准确，图表显示正常 |
| 主题切换 | 1. 日间/夜间模式切换流畅<br>2. 自定义主题功能正常，记住用户偏好 |

### 6.2 非功能验收
| 需求类型 | 验收标准 |
|----------|----------|
| 性能 | 1. 应用启动时间≤3秒<br>2. 页面响应时间≤0.5秒<br>3. 数据同步时间≤1秒 |
| 安全 | 1. 所有网络请求使用HTTPS<br>2. 密码使用加盐哈希存储<br>3. 本地数据使用AES-256加密 |
| 兼容性 | 1. 在Android 6.0+和iOS 12.0+设备上正常运行<br>2. 适配不同屏幕尺寸和设备方向 |
| 可用性 | 1. 界面符合Material Design 3规范<br>2. 操作流程直观，无需复杂培训<br>3. 错误提示清晰，易于理解 |

## 7. 风险与依赖

### 7.1 风险
| 风险ID | 风险描述 | 影响程度 | 可能性 | 缓解措施 |
|--------|----------|----------|--------|----------|
| R-001 | Flutter版本兼容性问题 | 中 | 低 | 锁定Flutter版本，定期测试兼容性 |
| R-002 | 生物识别功能在某些设备上不可用 | 中 | 中 | 提供密码锁作为备选方案 |
| R-003 | Firebase服务不稳定 | 高 | 低 | 实现本地缓存，减少对云端服务的依赖 |
| R-004 | 图片存储成本过高 | 中 | 中 | 实现图片压缩，限制单篇日记图片数量 |
| R-005 | 用户对隐私保护不信任 | 中 | 高 | 透明的隐私政策，强调数据加密和用户控制权 |

### 7.2 依赖
| 依赖项 | 用途 | 风险 |
|--------|------|------|
| Flutter | 应用开发框架 | 版本兼容性问题 |
| Firebase | 后端服务 | 服务稳定性和成本 |
| SQLite | 本地数据存储 | 数据迁移问题 |
| 第三方插件 | 提供额外功能 | 维护和更新问题 |

## 8. 附录

### 8.1 原型设计
[原型设计链接]（待补充）

### 8.2 界面设计规范
[界面设计规范链接]（待补充）

### 8.3 测试用例
[测试用例链接]（待补充）

---

**文档版本**：v1.0
**创建日期**：2025年12月28日
**审核人**：[待填写]
**批准人**：[待填写]